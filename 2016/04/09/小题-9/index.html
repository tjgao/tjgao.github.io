<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>小题-9 | Random Thoughts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="还是 leetcode 问题，还是那个最佳时间买卖股票的问题，只不过略作修改，问题的性质就可以发生极大变化。比如下面这个，加入了一个 cooldown 时间：">
<meta property="og:type" content="article">
<meta property="og:title" content="小题-9">
<meta property="og:url" content="http://tjgao.github.io/2016/04/09/小题-9/index.html">
<meta property="og:site_name" content="Random Thoughts">
<meta property="og:description" content="还是 leetcode 问题，还是那个最佳时间买卖股票的问题，只不过略作修改，问题的性质就可以发生极大变化。比如下面这个，加入了一个 cooldown 时间：">
<meta property="og:updated_time" content="2016-05-27T08:36:38.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小题-9">
<meta name="twitter:description" content="还是 leetcode 问题，还是那个最佳时间买卖股票的问题，只不过略作修改，问题的性质就可以发生极大变化。比如下面这个，加入了一个 cooldown 时间：">
  
    <link rel="alternative" href="/atom.xml" title="Random Thoughts" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/pang-blackwhite-final.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Tiejun Gao</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/tjgao" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://www.weibo.com/u/1403496193" title="weibo">weibo</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/algorithm/" style="font-size: 20px;">algorithm</a> <a href="/tags/dynamic-programming/" style="font-size: 16.67px;">dynamic programming</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/mathematics/" style="font-size: 10px;">mathematics</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/state-machine/" style="font-size: 10px;">state machine</a> <a href="/tags/string/" style="font-size: 10px;">string</a> <a href="/tags/suffix-array/" style="font-size: 10px;">suffix array</a> <a href="/tags/technology/" style="font-size: 10px;">technology</a> <a href="/tags/tomcat/" style="font-size: 10px;">tomcat</a> <a href="/tags/动态规划/" style="font-size: 16.67px;">动态规划</a> <a href="/tags/字符串/" style="font-size: 10px;">字符串</a> <a href="/tags/技术/" style="font-size: 10px;">技术</a> <a href="/tags/数学/" style="font-size: 10px;">数学</a> <a href="/tags/状态机/" style="font-size: 10px;">状态机</a> <a href="/tags/算法/" style="font-size: 20px;">算法</a> <a href="/tags/逆推/" style="font-size: 13.33px;">逆推</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">奥巴马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">卡卡的美丽传说</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">本泽马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">吉格斯的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">习大大大不同</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">托蒂的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">一个沉默的胖子</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Tiejun Gao</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/pang-blackwhite-final.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Tiejun Gao</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/tjgao" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://www.weibo.com/u/1403496193" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-小题-9" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/04/09/小题-9/" class="article-date">
  	<time datetime="2016-04-09T03:44:22.000Z" itemprop="datePublished">2016-04-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      小题-9
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dynamic-programming/">dynamic programming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/state-machine/">state machine</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/动态规划/">动态规划</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/状态机/">状态机</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/算法/">算法</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>还是 leetcode 问题，还是那个最佳时间买卖股票的问题，只不过略作修改，问题的性质就可以发生极大变化。比如下面这个，加入了一个 cooldown 时间：</p>
<a id="more"></a>
<blockquote>
<p>Say you have an array for which the $i^{th}$ element is the price of a given stock on day i.</p>
<p>Design an algorithm to find the maximum profit. You may complete as many transactions as you like (ie, buy one and sell one share of the stock multiple times) with the following restrictions:</p>
<ul>
<li>You may not engage in multiple transactions at the same time (ie, you must sell the stock before you buy again).</li>
<li>After you sell your stock, you cannot buy stock on next day. (ie, cooldown 1 day)</li>
</ul>
<p>Example:</p>
<p>prices = [1, 2, 3, 0, 2]</p>
<p>maxProfit = 3</p>
<p>transactions = [buy, sell, cooldown, buy, sell]</p>
</blockquote>
<p>第一感觉是动态规划问题，事实上好像确实也能解决。我第一版的方案是这样的：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">( <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; prices )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( prices.size() == <span class="number">0</span> ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; dp( prices.size() );</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i=prices.size()-<span class="number">2</span>; i&gt;=<span class="number">0</span>; i-- ) &#123;</span><br><span class="line">        <span class="keyword">int</span> low = prices[i], tmp; </span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">int</span> j=i; j&lt;prices.size(); j++ ) &#123;</span><br><span class="line">            low = min( low, prices[j] );</span><br><span class="line">            tmp = prices[j] - low;</span><br><span class="line">            dp[i] = max( dp[i], tmp + (j + <span class="number">2</span> &lt; prices.size() ? dp[j+<span class="number">2</span>] : <span class="number">0</span> ) );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中，<code>dp[i]</code>的含义是以索引<code>i</code>开始直到结束可能获得的最大利润。所以，从右向左，一个一个计算出<code>dp[i]</code>的值，最后<code>dp[0]</code>就是结果。其主要问题是，为了每次计算<code>dp[i]</code>的值，还要计算在<code>i</code>买入，在<code>(i, end]</code>之间某处卖出的利润，并加上卖出位置之后加上 cooldown 时间的<code>dp[j]</code>，所以其时间复杂度为 $O(n^2)$。提交以后也被系统接受了，但是悲摧的排在了<code>2%</code>的位置。</p>
<p>看了一些讨论，有人使用状态机结合动态规划的思路来完成这个问题，解法非常巧妙。</p>
<p>其基本思路为，考虑三种状态， <code>s0</code>，<code>s1</code>，<code>s2</code>，它们分别代表着未持有股票，持有股票，以及刚卖出股票后状态。买入后<code>s0</code>可转换为<code>s1</code>，卖出后<code>s1</code>变换为<code>s2</code>。</p>
<p>对于每一个<code>i</code>，这三者和以前的状态之间的关系可以写成：<br>$$s0[i] = max(s0[i-1], s2[i-1])$$<br>$$s1[i] = max(s1[i-1], s0[i-1] - prices[i])$$<br>$$s2[i] = s1[i-1] + prices[i]$$<br>注意，利润在卖出之前是负数。这些推算完毕之后，最后的最大利润应该是在<code>s0</code>和<code>s2</code>之间选择，因为如果最后你仍然处于持有股票的状态，是不可能利润最大化的。</p>
<p>根据这个思路，给三种状态一个初始值，就可以一直推算下去。其不加优化的简单实现为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; prices)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (prices.size() &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; s0(prices.size(), <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; s1(prices.size(), <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; s2(prices.size(), <span class="number">0</span>);</span><br><span class="line">    s1[<span class="number">0</span>] = -prices[<span class="number">0</span>];</span><br><span class="line">    s0[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    s2[<span class="number">0</span>] = INT_MIN;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; prices.size(); i++) &#123;</span><br><span class="line">        s0[i] = max(s0[i - <span class="number">1</span>], s2[i - <span class="number">1</span>]);</span><br><span class="line">        s1[i] = max(s1[i - <span class="number">1</span>], s0[i - <span class="number">1</span>] - prices[i]);</span><br><span class="line">        s2[i] = s1[i - <span class="number">1</span>] + prices[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max(s0[prices.size() - <span class="number">1</span>], s2[prices.size() - <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/05/27/小题-10/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          小题-10
        
      </div>
    </a>
  
  
    <a href="/2016/02/23/Configuration-of-nginx-and-tomcat-on-Linux/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Configuration of nginx and tomcat on Linux</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>





<section id="comments">
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'tiejungao'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Tiejun Gao
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>